<import src="../../components/noData/noData.wxml" />

<page class="wrap">


  <!--顶部fixed-->
  <view class="top-fixed">
    <view class="{{use?'active':''}}" bindtap="useClick">
      <view>
        <text>可用优惠券</text>
        <text wx:if="{{hasCoupon}}">({{couponNumb}})</text>
      </view>
    </view>
    <view class="{{unUse?'active':''}}" bindtap="unUseClick">
      <view>
        不可用优惠券
      </view>
    </view>
  </view>
  <scroll-view class="coupon-scroll-wrap" scroll-y="true" style="height:{{screenHeight-41}}px" scroll-top="{{scrollTop}}" bindscroll="listScroll">
  <!-- 可用优惠券 -->
  <block wx:if="{{hasCoupon}}">
    <view class="coupon-list" style="display:{{use?'block':'none'}}">
      <!-- 东券列表 -->
      <view class="coupon-box coupon-wrapper blue {{item.gray=='1'?'':'gray'}}" bindtap="checkCb" wx:for="{{dqArr}}" wx:key="unique" wx:for-index="index" data-index="{{index}}" data-type="1" data-id="{{item.id}}">
          <view class="coupon-wrap">
            <view class="left-box">
              <block wx:if="{{item.couponStyle=='3'}}">
                  <view class="m-box" wx:if="{{item.discountStrType==1}}">
                     <view class="f76">{{item.discountStr}}</view>
                     <view class="f30 d-unit">折</view>
                  </view>
                  <view class="m-box" wx:elif="{{item.discountStrType==2}}">
                    <view class="f76 multi-discount">{{item.discountStr}}</view>
                    <view class="f30 d-unit">折</view>
                  </view>
              </block>
              <view class="m-box" wx:else> 
                <view class="f30">¥</view>   
                <view class="f76">{{item.discount}}</view>
              </view>
              <view class="n-m discountLimit" wx:if="{{item.couponStyle=='3'}}">
                 <view class="txtOf">{{item.quotaStr}}</view>
              </view>
              <view class="n-m" wx:elif="{{item.quota > 0}}">
                 满{{item.quota}}元可用
              </view>
              <view class="r"></view>
            </view>
            <view class="right-box">
              <view class="right-l">
                <view class="coupon-l">
                  <view class="coupon-bg">东券</view>
                  <view class="coupon-font">{{item.scope}}</view>
                </view>
                <view class='overlay-wrap'>
                  <view wx:if='{{item.isSupportOverlay}}' class='overlay'>可叠加</view>
                </view>
                <view class="use-t">{{item.timeBegin}}-{{item.timeEnd}}</view>
              </view>
              <view class="right-r">
                <view class="check {{item.selected?'checked':''}}"></view>
              </view>
            </view>
          </view>
          <view wx:if="{{item.couponStyle=='3'}}"  class="moreDisInfo">
             <rich-text nodes="{{item.belowMsg1Map.belowMsg1}}"></rich-text>
            <view wx:if="{{item.belowMsg2}}">折扣说明：{{item.belowMsg2}}</view>
          </view>
      </view>
      <!-- 京券列表 -->
      <view class="coupon-box red {{item.gray=='1'?'':'gray'}}" bindtap="checkCb" wx:for="{{jqArr}}"  wx:key="unique" wx:for-index="index" data-index="{{index}}" data-type="2">
        <view class="left-box">
          <view class="m-box">
            <view class="f30">¥</view>
            <view class="f76">{{item.discount}}</view>
          </view>
          <view class="n-m">满{{item.quota}}元可用</view>
          <view class="r"></view>
        </view>
        <view class="right-box">
          <view class="right-l">
            <view class="coupon-l">
              <view class="coupon-bg">京券</view>
              <view class="coupon-font">{{item.scope}}</view>
            </view>
            <view class='overlay-wrap'>
              <view wx:if='{{item.isSupportOverlay}}' class='overlay'>可叠加</view>
            </view>
            <view class="use-t">{{item.timeBegin}}-{{item.timeEnd}}</view>
          </view>
          <view class="right-r">
            <view class="check {{item.selected?'checked':''}}"></view>
          </view>
        </view>
      </view>

      <!-- 运费券列表 -->
      <view class="coupon-box green {{item.gray=='1'?'':'gray'}}" bindtap="checkCb" wx:for="{{yfqArr}}" wx:key="unique" wx:for-index="index" data-index="{{index}}" data-type="3">
        <view class="left-box">
          <view class="m-box">
            <view class="f36">{{item.discount}}元</view>
          </view>
          <!-- <view class="n-m">除偏远山区、极速达</view> -->
          <view class="r"></view>
        </view>
        <view class="right-box">
          <view class="right-l">
            <view class="coupon-l">
              <view class="coupon-bg">运费券</view>
              <view class="coupon-font">{{item.scope}}</view>
            </view>
            <view class='overlay-wrap'>
              <view wx:if='{{item.isSupportOverlay}}' class='overlay'>可叠加</view>
            </view>
            <view class="use-t">{{item.timeBegin}}-{{item.timeEnd}}</view>
          </view>
          <view class="right-r">
            <view class="check {{item.selected?'checked':''}}"></view>
          </view>
        </view>
      </view>
      <view class='phoneXFillingStyleSec' wx:if="{{isIphoneX}}"></view>
    </view>
    <form bindsubmit="subBtn" report-submit="true" class="sub-btn" style="display:{{use?'block':'none'}}">
      <button form-type="submit" class="message-push-btn sub-btn {{isIphoneX?'phoneXStyle':''}}" style="display:{{use?'block':'none'}}">确定</button>
    </form>
  </block>
  <block wx:elif="{{use}}">
    <template is="noMoreData" data="{{...noAvailableItem}}" />
  </block>

  <!-- 不可用优惠券 -->
  <block wx:if="{{uncouponNumb > 0}}">
    <view class="coupon-list" style="display:{{unUse?'block':'none'}}">

      <!--不可用东券-->
      <view class="coupon-box coupon-wrapper blue gray" wx:for="{{undqArr}}" wx:key="unique">
        <view bindtap="toggleDiscountInfo"  data-type="{{item.couponStyle}}" data-id="{{item.id}}">
          <view class="coupon-wrap">
            <view class="left-box">
              <block wx:if="{{item.couponStyle=='3'}}">
                  <view class="m-box" wx:if="{{item.discountStrType==1}}">
                      <view class="f76">{{item.discountStr}}</view>
                      <view class="f30 d-unit">折</view>
                  </view>
                  <view class="m-box" wx:elif="{{item.discountStrType==2}}">
                    <view class="f76 multi-discount">{{item.discountStr}}</view>
                    <view class="f30 d-unit">折</view>
                  </view>
              </block>
              <view class="m-box" wx:else> 
                <view class="f30">¥</view>   
                <view class="f76">{{item.discount}}</view>
              </view>
              <view wx:if="{{ item.couponStyle == 3 }}"  class="n-m {{couponUseList[item.id]?'topArrow':''}}" >
                <view class="discountWrap">
                    <view class="discountDesc">{{item.quotaStr}}</view>
                    <view class="arrow-icon"></view> 
                </view>
              </view>
              <view class="n-m" wx:else>满{{item.quota}}元可用</view>
              <view class="r"></view>
            </view>
            <view class="right-box">
              <view class="right-l">
                <view class="coupon-l">
                  <view class="coupon-bg">东券</view>
                  <view class="coupon-font">{{item.scope}}</view>
                </view>
                <view class='overlay-wrap'>
                  <view wx:if='{{item.isSupportOverlay}}' class='overlay'>可叠加</view>
                </view>
                <view class="use-t">{{item.timeBegin}}-{{item.timeEnd}}</view>
              </view>
            </view>
          </view>
          <view wx:if="{{item.couponStyle=='3'&&couponUseList[item.id]}}" class="moreDisInfo">
            <!--<view>{{item.belowMsg1Map.belowMsg1}}</view>-->
            <view wx:if="{{item.belowMsg2}}">折扣说明：{{item.belowMsg2}}</view>
          </view>
        </view>
      </view>

      <!--不可用京券-->
      <view class="coupon-box red gray" wx:for="{{unjqArr}}" wx:key="unique">
        <view class="left-box">
          <view class="m-box">
            <view class="f30">¥</view>
            <view class="f76">{{item.discount}}</view>
          </view>
          <view class="n-m">满{{item.quota}}元可用</view>
          <view class="r"></view>
        </view>
        <view class="right-box">
          <view class="right-l">
            <view class="coupon-l">
              <view class="coupon-bg">京券</view>
              <view class="coupon-font">{{item.scope}}</view>
            </view>
            <view class='overlay-wrap'>
              <view wx:if='{{item.isSupportOverlay}}' class='overlay'>可叠加</view>
            </view>
            <view class="use-t">{{item.timeBegin}}-{{item.timeEnd}}</view>
          </view>
        </view>
      </view>

      <!--&lt;!&ndash;可用京券  也得放在不可用 因为不让用&ndash;&gt;-->
      <!--<view class="coupon-box red gray" wx:for="{{jqArr}}" wx:key="unique">-->
        <!--<view class="left-box">-->
          <!--<view class="m-box">-->
            <!--<view class="f30">¥</view>-->
            <!--<view class="f76">{{item.discount}}</view>-->
          <!--</view>-->
          <!--<view class="n-m">满{{item.quota}}元可用</view>-->
          <!--<view class="r"></view>-->
        <!--</view>-->
        <!--<view class="right-box">-->
          <!--<view class="right-l">-->
            <!--<view class="coupon-l">-->
              <!--<view class="coupon-bg">京券</view>-->
              <!--<view class="coupon-font">{{item.scope}}</view>-->
            <!--</view>-->
            <!--<view class="use-t">{{item.timeBegin}}-{{item.timeEnd}}</view>-->
          <!--</view>-->
        <!--</view>-->
      <!--</view>-->

      <!--不可用运费券-->
      <view class="coupon-box green gray" wx:for="{{unyfqArr}}" wx:key="unique">
        <view class="left-box">
          <view class="m-box">
            <view class="f36">{{item.discount}}元</view>
          </view>
          <!-- <view class="n-m">除偏远山区、极速达</view> -->
          <view class="r"></view>
        </view>
        <view class="right-box">
          <view class="right-l">
            <view class="coupon-l">
              <view class="coupon-bg">运费券</view>
              <view class="coupon-font">{{item.scope}}</view>
            </view>
            <view class='overlay-wrap'>
              <view wx:if='{{item.isSupportOverlay}}' class='overlay'>可叠加</view>
            </view>
            <view class="use-t">{{item.timeBegin}}-{{item.timeEnd}}</view>
          </view>
        </view>
      </view>

    </view>
  </block>
  <block wx:elif="{{unUse}}">
    <template is="noMoreData" data="{{...noUnavailableItem}}" />
  </block>
  <image class="bottom-to-top" src="http://commonst.360buyimg.com/common/wx-images/scroll-to-top-icon.png" style="display:{{toTopDisplay}}" bindtap="toTopTap"></image>
  </scroll-view>
</page>
